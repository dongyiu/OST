%%{init: {'theme': 'neutral', 'themeVariables': { 'fontSize': '12px'}}}%%
flowchart TD
    A[User Profile & Preferences] --> B[Semantic OST Initialization]
    B --> C[Context System]
    C --> D[Enhanced Bayesian Model]
    D -->|Generates prior beliefs| E[Market Expectations]
    B --> F[Enhanced Preference Processor]
    F -->|Sets| G[Hard Constraints]
    F -->|Calculates| H[Variable Weights]
    
    subgraph OST Core Mechanism
        I[Time Grid & Value Function]
        J[Backward Induction]
        K[Reservation Utilities]
        I --> J
        J --> K
    end
    
    D -->|Initial market data| J
    C -->|Field/Experience context| J
    F -->|Preference weights| J
    
    subgraph Offer Processing Loop
        L[Generate Job Offer]
        M[Check Hard Constraints]
        N[Calculate Offer Utility]
        O[Compare Utility vs Threshold]
        P[Accept/Reject Decision]
        Q[Update Bayesian Model]
        R[Adjust Thresholds]
        
        L --> M
        M -->|Pass| N
        M -->|Fail| P
        N --> O
        O --> P
        P -->|Reject| Q
        Q --> R
        R --> L
    end
    
    D -->|Market beliefs| L
    K -->|Thresholds| O
    C -->|Context rules| N
    F -->|Utility calc| N
    Q -->|New observations| D
    R -->|Updated thresholds| K
    
    classDef box fill:#e0f2fe,stroke:#0369a1;
    classDef process fill:#f0fdf4,stroke:#15803d;
    classDef data fill:#fff1f2,stroke:#be123c;
    class A,C,D,E,F,G,H data
    class B,I,J,K,L,M,N,O,P,Q,R process
    class OST,Offer box